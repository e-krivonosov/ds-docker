# ds-docker
## Запуск окружения битрикс
- Перемещаемся в каталог c докером `cd docker`
- Выполняем команду `./rebuildrestart.sh`
## Запуск тестов из контейнера
Время жизни контейнера с тестом равно времени исполнения теста.
- Перемещаемся в каталог c докером `cd docker`
- Выполняем команду `./codecept.sh run acceptance --steps`
- Добавляем в `/etc/hosts` строку `192.168.10.2 evk.local www.evk.local`
---
Скрипт `./codecept.sh` инициализирует контейнер таким образом. 
что утилита `codecept` внутри контейнера будет принимать на вход
все параметры, которые будут переданы скрипту. То есть это равносильно
запуску утилиты `codecept` напрямую. Необходимо лишь учитывать, что 
окружение внутри контейнера отличается от вашего.
## Подключение к БД MySql
Подключение к MySql внутри контейнера

    host=mysql
    user=root
    password=

Подключение к MySql извне
    host=192.168.10.4
    user=root
    password=
# Структура BITRIX
## Ядро
    /bitrix/

## Пользовательска часть ядра
    /local/
## Структура ядра /bitrix/

    /admin/ - административные скрипты;
    /cache/ - файлы кэша;
    /activities/ - папки действий для бизнес-процессов;
    /components/ - папка для системных и пользовательских компонентов;
    /gadgets/ - папки гаджетов;
    /js/ - файлы javascript модулей;
    /stack_cache/ - файлы кеша "с вытеснением";
    /themes/ - темы административного раздела;
    /wizards/ - папки мастеров;
    /images/ - изображения используемые как системой в целом, так и отдельными модулями;
    /managed_cache/ - управляемый кеш;
    /modules/ - каталог с модулями системы, каждый подкаталог которого имеет свою строго определённую структуру;
    /php_interface/ - вспомогательный служебный каталог, в него входят следующие каталоги и файлы:
        dbconn.php - параметры соединения с базой;
        init.php - дополнительные параметры портала;
        after_connect.php - подключается сразу же после создания соединения с базой;
        dbconn_error.php - подключается при ошибке в момент создания соединения с базой;
        dbquery_error.php - подключается при ошибке в момент выполнения SQL запроса;
        /ID сайта/init.php - дополнительные параметры сайта; файл подключается сразу же после определения специальной константы c идентификатором сайта - SITE_ID; 
    /templates/ - каталог с шаблонами сайтов и компонентов , в него входят следующие подкаталоги:
        /.default/ - подкаталог с общими файлами, используемыми тем или иным шаблоном по умолчанию, структура данного каталога аналогична нижеописанной структуре каталога содержащего конкретный шаблон;
        /ID шаблона сайта/ - подкаталог с шаблоном сайта, в него входят следующие подкаталоги и файлы:
        /components/ - каталог с кастомизированными шаблонами компонентов;
        /lang/ - языковые файлы принадлежащие как данному шаблону в целом, так и отдельным компонентам;
        /images/ - каталог с изображениями данного шаблона;
        /page_templates/ - каталог с шаблонами страниц и их описанием хранящимся в файле .content.php. Когда пользователь создает новую страницу, он может выбрать, по какому шаблону из представленных в этом каталоге это будет сделано;
        header.php - пролог данного шаблона;
        footer.php - эпилог данного шаблона;
        template_styles.css - основной файл стилей для шаблона;
        styles.css - CSS стили шаблона для визуального редактора (вкладка Стили сайта); 
    /tools/ - при инсталляции в этот каталог копируются дополнительные страницы, которые могут быть непосредственно использованы на любых страницах сайта: помощь, календарь, показ изображения и т.п.;
    /updates/ - каталог, автоматически создаваемый системой обновлений;
    header.php - стандартный файл, подключающий в свою очередь конкретный пролог текущего шаблона сайта; данный файл должен использоваться на всех страницах публичной части;
    footer.php - стандартный файл, подключающий в свою очередь конкретный эпилог текущего шаблона сайта; данный файл должен использоваться на всех страницах публичной части;
    license_key.php - файл с лицензионным ключом;
    spread.php - файл используемый главным модулем для переноса куков посетителя на дополнительные домены различных сайтов;
    redirect.php - файл используемый модулем Статистика для фиксации событий перехода по ссылке;
    rk.php - файл по умолчанию используемый модулем Реклама для фиксации событий клика по баннеру;
    stop_redirect.php - файл используемый модулем Статистика для выдачи какого либо сообщения посетителю, попавшему в стоп-лист;
    activity_limit.php - файл используемый модулем Статистика для выдачи сообщения роботу при превышении им лимита активности;
    и другие служебные файлы и папки.

## Структура ядра /local/modules/MODULE_ID/
    admin/ - каталог с административными скриптами модуля;
    menu.php - файл с административным меню модуля;
    classes/ - скрипты с классами модуля;
        general/ - классы модуля, не зависящие от используемой базы данных;
        mysql/ - классы модуля, предназначенные для работы только с MySQL;
        mssql/ - классы модуля, предназначенные для работы только с MS SQL;
        oracle/ - классы модуля, предназначенные для работы только с Oracle;
    lang/ID языка/ - каталог с языковыми файлами скриптов модуля;
    lib/ - каталог с файлами (API: классы, логика) нового ядра D7 (может не присутствовать, если у модуля нет собственных методов);
    install/ - каталог с файлами используемыми для инсталляции и деинсталляции модуля;
        admin/ - каталог со скриптами подключающими административные скрипты модуля (вызывающие скрипты);
        js/ - каталог с js-скриптами модуля. Копируются в /bitrix/js/ID_модуля/;
        db/ - каталог с SQL скриптами для инсталляции/деинсталляции базы данных;
            mysql/ - SQL скрипты для инсталляции/деинсталляции таблиц в MySQL;
            mssql/ - SQL скрипты для инсталляции/деинсталляции таблиц в MS SQL;
            oracle/ - SQL скрипты для инсталляции/деинсталляции таблиц в Oracle;
        images/ - каталог с изображениями используемыми модулем; после инсталляции модуля они должны быть скопированы в каталог /bitrix/images/ID модуля/;
        templates/ - каталог с компонентами 1.0 модуля. (Каталог сохраняется только с целью совместимости версий.);
            ID модуля/ - каталог с основными файлами компонент;
            lang/ID языка/ID модуля/ - в данном каталоге находятся языковые файлы компонент модуля;
        components/пространство имен/имя компонента/ - каталог с компонентами 2.0 модуля;
        themes/имя_модуля/ - содержит css и картинки для стилей административной панели, если модуль в таковых нуждается (Устаревшая, до версии 12.0);
        panel/имя_модуля/ - содержит css и картинки для стилей административной панели, если модуль в таковых нуждается.
    index.php - файл с описанием модуля;
    version.php - файл с номером версии модуля. Версия не может быть равной нулю.
    include.php - данный файл подключается в тот момент, когда речь идет о подключении модуля в коде, в нем должны находиться включения всех файлов с библиотеками функций и классов модуля;
    default_option.php - содержит массив с именем $ID модуля_default_option, в котором заданы значения по умолчанию для параметров модуля; 
    options.php - данный файл подключается на странице настройки параметров модулей в административном меню Настройки;
    prolog.php - файл может подключаться во всех административных скриптах модуля. Обычно в нем определяется константа ADMIN_MODULE_NAME (идентификатор модуля), используемая в панели управления;
    .settings.php - файл настроек модуля, описывающий настройки модуля, которые можно прочитать через \Bitrix\Main\Config\Configuration::getInstance($module).

### Стандартные файлы подключение пролога и эпилога
    <?
    // подключение пролога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");
    ?>
    тело страницы
    <?
    // подключение эпилога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");
    ?>
### Стандартные файлы подключение пролога и эпилога с разделением
    <?
    // подключение служебной части пролога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_before.php");
    
    // подключение визуальной части пролога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_after.php");
    
    ?>
    Содержимое страницы
    <?
    
    // подключение визуальной части эпилога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/epilog_before.php");
    
    // подключение служебной части эпилога
    require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/epilog_after.php");
    ?>
### Работа с панелью битрикса

    /bitrix/php_interface/include/add_top_panel.php

автоматически будет подключен при выводе панели.